# UI Compiler (uic) Tool

The ForGE UI Compiler (uic) is a code generation tool that converts Qt-style UI definition files (.ui) into Fortran widget code, enabling declarative UI design.

## Overview

The uic tool processes XML-based UI files (similar to Qt Designer output) and generates Fortran modules containing widget declarations and setup code. This enables:

- Declarative UI design using XML
- Separation of UI design from application logic
- Qt Designer compatibility
- Automatic widget instantiation and configuration

## Usage

### Basic Usage

```bash
forge_uic [options] <input_file.ui>
```

### Command Line Options

- `-o, --output <file>`: Specify output file (default: `ui_<input>.f90`)
- `-h, --header`: Generate header file with declarations
- `-v, --verbose`: Enable verbose output
- `--help`: Display help information

### Examples

```bash
# Generate implementation file
forge_uic mainwindow.ui

# Generate header file
forge_uic -h mainwindow.ui -o ui_mainwindow.f90

# Verbose output with custom output
forge_uic -v -o generated_ui.f90 dialog.ui
```

## Input File Format

The uic tool processes Qt-style .ui files containing XML widget definitions.

### Basic UI File Structure

```xml
<?xml version="1.0" encoding="UTF-8"?>
<ui version="4.0">
 <class>MainWindow</class>
 <widget class="QMainWindow" name="MainWindow">
  <property name="geometry">
   <rect>
    <x>0</x>
    <y>0</y>
    <width>800</width>
    <height>600</height>
   </rect>
  </property>
  <property name="windowTitle">
   <string>Main Window</string>
  </property>
  <widget class="QWidget" name="centralwidget">
   <layout class="QVBoxLayout" name="verticalLayout">
    <item>
     <widget class="QPushButton" name="pushButton">
      <property name="text">
       <string>Click Me</string>
      </property>
     </widget>
    </item>
    <item>
     <widget class="QLabel" name="label">
      <property name="text">
       <string>Hello World</string>
      </property>
     </widget>
    </item>
   </layout>
  </widget>
 </widget>
 <resources/>
 <connections/>
</ui>
```

### Supported Widget Types

The uic tool recognizes and converts the following Qt widget classes:

- `QPushButton` → `forge_button`
- `QLabel` → `forge_label`
- `QLineEdit` → `forge_entry`
- `QTextEdit` → `forge_text_view`
- `QCheckBox` → `forge_check_box`
- `QRadioButton` → `forge_radio_button`
- `QComboBox` → `forge_combo_box`
- `QSpinBox` → `forge_spin_button`
- `QSlider` → `forge_slider`
- `QGroupBox` → `forge_group_box`
- `QTabWidget` → `forge_tab_widget`
- `QTableWidget` → `forge_table_widget`
- `QTreeWidget` → `forge_tree_widget`
- `QListWidget` → `forge_list_widget`
- `QScrollArea` → `forge_scroll_area`
- `QMenuBar` → `forge_menu_bar`
- `QStatusBar` → `forge_status_bar`

## Generated Output

### Header File Generation (-h)

When using the `-h` option, uic generates a module with widget declarations:

```fortran
! Generated by ForGE UI Compiler (header)
module ui_mainwindow
    use forge_widgets
    implicit none

    ! UI widget declarations
    type(forge_button) :: pushButton
    type(forge_label) :: label

contains

    subroutine setup_ui(this)
        class(*), intent(inout) :: this
        ! Setup UI widgets and connections
        ! Setup pushButton
        call pushButton%init()
        call pushButton%set_object_name('pushButton')
        ! Setup label
        call label%init()
        call label%set_object_name('label')
    end subroutine setup_ui

end module ui_mainwindow
```

### Implementation File Generation (default)

By default, uic generates a submodule with implementation details:

```fortran
! Generated by ForGE UI Compiler (implementation)
submodule (ui_mainwindow) ui_mainwindow_impl
    implicit none

contains

    module subroutine setup_ui(this)
        class(*), intent(inout) :: this
        ! Implementation of UI setup
        ! Initialize pushButton
        call pushButton%init()
        ! Initialize label
        call label%init()
    end subroutine setup_ui

end submodule ui_mainwindow_impl
```

## Integration with Build Systems

### CMake Integration

```cmake
# Find ForGE
find_package(ForGE REQUIRED)

# Generate UI files
forge_uic_generate(UI_HEADERS mainwindow.ui)
forge_uic_generate(UI_SOURCES dialog.ui)

# Add to executable
add_executable(my_app main.cpp ${UI_HEADERS} ${UI_SOURCES})
target_link_libraries(my_app ForGE::forge)
```

### FPM Integration

```toml
# fpm.toml
[build]
# Pre-build commands
prebuild = [
    "forge_uic mainwindow.ui -o ui_mainwindow.f90",
    "forge_uic dialog.ui -o ui_dialog.f90"
]

[[executable]]
name = "my_app"
sources = ["my_app.f90", "ui_mainwindow.f90", "ui_dialog.f90"]
```

### Make Integration

```makefile
# Makefile
UIC = forge_uic
FORTRAN = gfortran

# Generate UI files
ui_mainwindow.f90: mainwindow.ui
	$(UIC) $< -o $@

ui_dialog.f90: dialog.ui
	$(UIC) $< -o $@

# Build application
my_app: my_app.f90 ui_mainwindow.f90 ui_dialog.f90
	$(FORTRAN) $^ -o $@ -lforge
```

## Using Generated UI Code

### Basic Usage

```fortran
program my_app
    use forge
    use ui_mainwindow  ! Generated module

    type(forge_application) :: app
    type(forge_window_t) :: window
    type(forge_status) :: status

    ! Initialize application
    call app%init(BACKEND_QT, status)

    ! Create window
    window = app%create_window("My App", 800, 600)

    ! Setup UI using generated code
    call setup_ui(window)

    ! Connect signals
    call pushButton%on_click(handle_button_click)

    ! Show window
    call window%show()
    call app%run()

contains

    subroutine handle_button_click(event)
        type(forge_event), intent(in) :: event
        call label%set_text("Button clicked!")
    end subroutine handle_button_click

end program my_app
```

### Advanced Usage with Custom Classes

```fortran
type, extends(forge_window_t) :: main_window
    ! Include generated UI elements
    use ui_mainwindow, only: pushButton, label, setup_ui

contains
    procedure :: init_ui
end type main_window

subroutine init_ui(this)
    class(main_window), intent(inout) :: this

    ! Setup UI using generated code
    call setup_ui(this)

    ! Additional custom setup
    call pushButton%set_label("Custom Button")
    call label%set_text("Custom Label")
end subroutine init_ui
```

## Qt Designer Integration

### Creating UI Files

1. **Open Qt Designer**
   ```
   designer mainwindow.ui
   ```

2. **Design your interface** using drag-and-drop widgets

3. **Save the .ui file**

4. **Generate Fortran code**
   ```bash
   forge_uic mainwindow.ui
   ```

### Designer Features Supported

- **Widget palette**: All standard Qt widgets
- **Property editor**: Widget properties and settings
- **Layout management**: Automatic and manual layouts
- **Signal/slot editor**: Connection definitions
- **Resource editor**: Image and resource management

## Advanced Features

### Layout Support

UI files can include layout information:

```xml
<layout class="QVBoxLayout" name="verticalLayout">
 <item>
  <widget class="QPushButton" name="button1"/>
 </item>
 <item>
  <widget class="QPushButton" name="button2"/>
 </item>
</layout>
```

Generated code will include layout setup.

### Property Setting

Widget properties from the UI file are applied:

```xml
<widget class="QPushButton" name="myButton">
 <property name="text">
  <string>Click Me</string>
 </property>
 <property name="enabled">
  <bool>true</bool>
 </property>
</widget>
```

### Signal/Slot Connections

UI files can define signal/slot connections:

```xml
<connections>
 <connection>
  <sender>pushButton</sender>
  <signal>clicked()</signal>
  <receiver>MainWindow</receiver>
  <slot>handleButtonClick()</slot>
 </connection>
</connections>
```

## Error Handling

### Common Errors

1. **Invalid XML syntax**
   ```
   Error: Unable to parse UI file - invalid XML
   Solution: Validate XML syntax in UI file
   ```

2. **Unsupported widget type**
   ```
   Warning: Unknown widget type 'QCustomWidget'
   Solution: Widget will be treated as generic forge_widget
   ```

3. **Missing required properties**
   ```
   Warning: Widget missing required 'name' property
   Solution: Ensure all widgets have unique names
   ```

### Verbose Mode

Use `-v` for detailed processing information:

```bash
forge_uic -v mainwindow.ui
```

Shows:
- Widgets found and their types
- Properties being processed
- Generated code statistics

## Performance Considerations

### Compilation Time

- UI parsing is fast (typically < 1 second)
- Generated code compiles efficiently
- Minimal impact on build times

### Runtime Performance

- Generated code is optimized
- No runtime XML parsing
- Direct widget instantiation

### Memory Usage

- Generated code is compact
- No additional runtime overhead
- Widgets created only when needed

## Best Practices

### UI Design

1. **Use descriptive widget names** for maintainability
2. **Group related widgets** in layouts
3. **Use appropriate widget types** for the task
4. **Test UI on target platforms**

### Build System Integration

1. **Generate UI files in build directory**
2. **Include UI files in dependency tracking**
3. **Clean generated files during clean operations**

### Code Organization

1. **Separate UI logic from business logic**
2. **Use generated UI modules appropriately**
3. **Document custom UI modifications**

## Examples

### Simple Dialog

```xml
<!-- simple_dialog.ui -->
<ui version="4.0">
 <class>SimpleDialog</class>
 <widget class="QDialog" name="SimpleDialog">
  <property name="windowTitle">
   <string>Simple Dialog</string>
  </property>
  <layout class="QVBoxLayout">
   <item>
    <widget class="QLabel" name="messageLabel">
     <property name="text">
      <string>Enter your name:</string>
     </property>
    </widget>
   </item>
   <item>
    <widget class="QLineEdit" name="nameEdit"/>
   </item>
   <item>
    <widget class="QDialogButtonBox" name="buttonBox">
     <property name="standardButtons">
      <set>QDialogButtonBox::Ok|QDialogButtonBox::Cancel</set>
     </property>
    </widget>
   </item>
  </layout>
 </widget>
</ui>
```

Generated code provides `messageLabel`, `nameEdit`, and `buttonBox` widgets.

### Complex Main Window

```xml
<!-- mainwindow.ui -->
<ui version="4.0">
 <class>MainWindow</class>
 <widget class="QMainWindow" name="MainWindow">
  <widget class="QMenuBar" name="menubar"/>
  <widget class="QStatusBar" name="statusbar"/>
  <widget class="QWidget" name="centralwidget">
   <layout class="QHBoxLayout">
    <item>
     <widget class="QTreeWidget" name="fileTree"/>
    </item>
    <item>
     <widget class="QTextEdit" name="textEditor"/>
    </item>
   </layout>
  </widget>
 </widget>
</ui>
```

Creates a main window with menu bar, status bar, file tree, and text editor.

## Troubleshooting

### Build Issues

**Problem**: UI-generated files not found
**Solution**: Ensure uic runs before compilation

**Problem**: Linker errors with UI symbols
**Solution**: Include UI modules in compilation

### Runtime Issues

**Problem**: Widgets not appearing as expected
**Solution**: Check generated setup code and layout

**Problem**: Signal connections not working
**Solution**: Verify widget names match between UI and code

## See Also

- [Qt Designer Documentation](https://doc.qt.io/qt-5/designer-manual.html)
- [MOC Tool](moc_tool.md) - Meta-object compiler
- [RCC Tool](rcc_tool.md) - Resource compiler
- [UI Design Tutorial](../tutorials/ui_design.md)